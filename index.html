<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTC RECOVERY - START COMMAND</title>
    <style>
        body { background: #0b0e11; color: white; font-family: sans-serif; text-align: center; padding: 10px; }
        .card { border: 2px solid #f3ba2f; border-radius: 15px; padding: 15px; background: #1e2329; }
        .price { font-size: 40px; font-weight: bold; color: #f3ba2f; margin: 10px 0; }
        .status-on { color: #00ff88; font-weight: bold; }
        .log-box { text-align: left; background: #000; padding: 10px; height: 150px; overflow-y: auto; font-size: 11px; color: #00ff88; border: 1px solid #333; margin-top: 10px; }
    </style>
</head>
<body onload="initBot()"> <div class="card">
        <div id="botStatus" style="font-size: 12px; color: #ff4d4d;">üî¥ BOT ƒêANG T·∫ÆT - G√ï /START ƒê·ªÇ CH·∫†Y</div>
        <div id="btcPrice" class="price">0.00</div>
        <div id="info" style="font-size: 13px; color: #848e9c;">S·∫µn s√†ng nh·∫≠n l·ªánh t·ª´ Telegram...</div>
        <div id="logs" class="log-box">> H·ªá th·ªëng ƒë√£ load. Ch·ªù l·ªánh /start...</div>
    </div>

    <script>
        const TOKEN = "8586899878:AAHONzWJqzUMswUPMjn5xaWvYrwDHSH4OYE";
        const CHAT_ID = "7994694689";
        let isRunning = false, lastUpdateId = 0, priceOffset = -80;
        let currentPrice = 0, currentRsi = 0, lastAction = "";
        let tradeHistory = [];

        // Kh·ªüi t·∫°o ch·∫ø ƒë·ªô l·∫Øng nghe ngay khi m·ªü web
        function initBot() {
            addLog("ƒêang l·∫Øng nghe Telegram...");
            setInterval(checkTele, 1500); 
        }

        async function updateData() {
            if (!isRunning) return;
            try {
                const r = await fetch(`https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=1m&limit=50`);
                const d = await r.json();
                const prices = d.map(x => parseFloat(x[4]));
                currentPrice = prices[prices.length - 1];

                // T√≠nh RSI nhanh
                let g = 0, l = 0;
                for (let i = prices.length - 14; i < prices.length; i++) {
                    let diff = prices[i] - prices[i-1];
                    if (diff >= 0) g += diff; else l -= diff;
                }
                currentRsi = 100 - (100 / (1 + (g / l)));

                document.getElementById('btcPrice').innerText = (currentPrice + priceOffset).toFixed(2);
                document.getElementById('info').innerText = `M1: ${currentRsi.toFixed(2)} | Offset: ${priceOffset}`;

                // Logic b√°o k√®o t·ª± ƒë·ªông
                if (currentRsi <= 40 && lastAction !== "BUY") {
                    sendTele(`üíé [K√àO BUY]\nüìç Entry: ${(currentPrice + priceOffset).toFixed(2)}\nüìä RSI: ${currentRsi.toFixed(2)}`);
                    lastAction = "BUY";
                } else if (currentRsi >= 60 && lastAction !== "SELL") {
                    sendTele(`üíé [K√àO SELL]\nüìç Entry: ${(currentPrice + priceOffset).toFixed(2)}\nüìä RSI: ${currentRsi.toFixed(2)}`);
                    lastAction = "SELL";
                }
            } catch (e) {}
        }

        async function checkTele() {
            try {
                const r = await fetch(`https://api.telegram.org/bot${TOKEN}/getUpdates?offset=${lastUpdateId + 1}&timeout=1`);
                const d = await r.json();
                if (d.result && d.result.length > 0) {
                    for (let u of d.result) {
                        lastUpdateId = u.update_id;
                        const m = u.message.text.toLowerCase();

                        if (m === "/start") {
                            isRunning = true;
                            setInterval(updateData, 2000);
                            document.getElementById('botStatus').innerHTML = "üü¢ BOT ƒêANG CH·∫†Y K√àO...";
                            document.getElementById('botStatus').className = "status-on";
                            sendTele("üöÄ H·ªÜ TH·ªêNG ƒê√É K√çCH HO·∫†T! ƒêang qu√©t k√®o BTC...");
                            addLog("L·ªánh /start nh·∫≠n th√†nh c√¥ng!");
                        }
                        else if (m === "/tp" || m === "/sl") {
                            tradeHistory.push({ res: m.toUpperCase(), time: new Date().toLocaleTimeString() });
                            lastAction = ""; 
                            sendTele(`‚úÖ ƒê√£ l∆∞u ${m.toUpperCase()}. Ch·ªù k√®o m·ªõi...`);
                        }
                        else if (m === "/history") {
                            let txt = tradeHistory.map(t => `${t.time}: ${t.res}`).join("\n");
                            sendTele(`üìú L·ªäCH S·ª¨:\n${txt || "Ch∆∞a c√≥ d·ªØ li·ªáu"}`);
                        }
                    }
                }
            } catch (e) {}
        }

        function addLog(msg) {
            const l = document.getElementById('logs');
            l.innerHTML += `<br>> ${msg}`;
            l.scrollTop = l.scrollHeight;
        }

        function sendTele(m) { fetch(`https://api.telegram.org/bot${TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=${encodeURIComponent(m)}`); }
    </script>
</body>
</html>
