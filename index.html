<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTC RECOVERY MAX VIP</title>
    <style>
        body { background: #0b0e11; color: white; font-family: sans-serif; text-align: center; padding: 10px; }
        .card { border: 2px solid #f3ba2f; border-radius: 15px; padding: 15px; background: #1e2329; box-shadow: 0 0 20px rgba(243, 186, 47, 0.2); }
        .price { font-size: 40px; font-weight: bold; color: #f3ba2f; margin: 10px 0; }
        .info { font-size: 14px; color: #848e9c; margin-bottom: 10px; }
        .log-box { text-align: left; background: #000; padding: 10px; height: 140px; overflow-y: auto; font-size: 11px; color: #00ff88; border: 1px solid #333; }
        button { width: 100%; padding: 18px; background: #f3ba2f; color: black; font-weight: bold; border-radius: 10px; border: none; font-size: 20px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="card">
        <div style="font-size: 12px; color: #00ff88; font-weight: bold;">üíé H·ªÜ TH·ªêNG G·ª† $23 - MAX VIP</div>
        <div id="btcPrice" class="price">0.00</div>
        <div id="statusInfo" class="info">M1: -- | M5: -- | EMA9: -- | Offset: 0</div>
        <div id="logs" class="log-box">ƒêang ƒë·ª£i l·ªánh...</div>
        <button onclick="startVipBot()">K√çCH HO·∫†T H·ªÜ TH·ªêNG</button>
    </div>

    <script>
        const TOKEN = "8586899878:AAHONzWJqzUMswUPMjn5xaWvYrwDHSH4OYE";
        const CHAT_ID = "7994694689";
        let lastAction = "", lastUpdateId = 0, isPaused = false;
        let rsiBuy = 40, rsiSell = 60, priceOffset = 0;
        const audio = new Audio('https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3');

        async function startVipBot() {
            setInterval(updateData, 2000); 
            setInterval(checkTele, 2000);
            sendTele("üöÄ BTC MAX VIP READY!\n/offset [s·ªë] : B√π gi√° Exness\n/setrsi [s·ªë] : ƒê·ªïi ƒë·ªô nh·∫°y\n/check : Xem tr·∫°ng th√°i");
        }

        async function getRsi(interval) {
            try {
                const r = await fetch(`https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=${interval}&limit=100`);
                const d = await r.json();
                const prices = d.map(x => parseFloat(x[4]));
                let g = 0, l = 0;
                for (let i = prices.length - 14; i < prices.length; i++) {
                    let diff = prices[i] - prices[i-1];
                    if (diff >= 0) g += diff; else l -= diff;
                }
                const rsi = 100 - (100 / (1 + (g / l)));
                return { rsi, price: prices[prices.length - 1], prices };
            } catch (e) { return null; }
        }

        async function updateData() {
            if (isPaused) return;
            const m1 = await getRsi('1m');
            const m5 = await getRsi('5m');
            if (!m1 || !m5) return;

            // T√≠nh EMA 9
            const k = 2 / (9 + 1);
            let ema9 = m1.prices[0];
            for (let i = 1; i < m1.prices.length; i++) { ema9 = (m1.prices[i] * k) + (ema9 * (1 - k)); }

            document.getElementById('btcPrice').innerText = (m1.price + priceOffset).toFixed(2);
            document.getElementById('statusInfo').innerText = `M1: ${m1.rsi.toFixed(2)} | M5: ${m5.rsi.toFixed(2)} | EMA9: ${ema9.toFixed(2)} | Offset: ${priceOffset}`;

            // LOGIC √âP L·ªÜNH VIP + EMA
            if (m1.rsi <= rsiBuy && m1.price > ema9 && lastAction !== "BUY") {
                triggerSignal("BUY", m1.price, m1.rsi, m5.rsi);
                lastAction = "BUY";
            } else if (m1.rsi >= rsiSell && m1.price < ema9 && lastAction !== "SELL") {
                triggerSignal("SELL", m1.price, m1.rsi, m5.rsi);
                lastAction = "SELL";
            }
        }

        function triggerSignal(side, price, r1, r5) {
            audio.play();
            const entry = price + priceOffset;
            const sl = side === "SELL" ? entry + 100 : entry - 100;
            const tp1 = side === "SELL" ? entry - 100 : entry + 100;
            const tp2 = side === "SELL" ? entry - 250 : entry + 250;
            const tp3 = side === "SELL" ? entry - 500 : entry + 500;
            
            let m = `üíé [K√àO MAX VIP ${side}]\nüìç Entry: ${entry.toFixed(2)}\nüö´ SL: ${sl.toFixed(2)}\nüéØ TP1: ${tp1.toFixed(2)}\nüéØ TP2: ${tp2.toFixed(2)}\nüéØ TP3: ${tp3.toFixed(2)}\nüìä RSI M1: ${r1.toFixed(2)} | M5: ${r5.toFixed(2)}`;
            sendTele(m);
            const l = document.getElementById('logs');
            l.innerHTML += `<br>> ƒê√£ n·ªï k√®o ${side} l√∫c ${new Date().toLocaleTimeString()}`;
            l.scrollTop = l.scrollHeight;
        }

        async function checkTele() {
            try {
                const r = await fetch(`https://api.telegram.org/bot${TOKEN}/getUpdates?offset=${lastUpdateId + 1}`);
                const d = await r.json();
                if (!d.result) return;
                for (let u of d.result) {
                    lastUpdateId = u.update_id;
                    const m = u.message.text.toLowerCase();
                    if (m.startsWith("/offset")) {
                        priceOffset = parseFloat(m.split(" ")[1]) || 0;
                        sendTele(`‚úÖ ƒê√£ b√π gi√°: ${priceOffset}. Gi√° hi·ªán t·∫°i tr√™n Bot: ${(parseFloat(document.getElementById('btcPrice').innerText)).toFixed(2)}`);
                    } else if (m.startsWith("/setrsi")) {
                        rsiBuy = parseInt(m.split(" ")[1]) || 40;
                        rsiSell = 100 - rsiBuy;
                        sendTele(`‚úÖ ƒê√£ ch·ªânh RSI: ${rsiBuy}/${rsiSell}`);
                    } else if (m === "/tp" || m === "/sl") {
                        lastAction = ""; sendTele("üîÑ ƒê√£ Reset. ƒêang sƒÉn k√®o m·ªõi...");
                    } else if (m === "/check") {
                        sendTele(`üìä TR·∫†NG TH√ÅI:\nGi√°: ${document.getElementById('btcPrice').innerText}\n${document.getElementById('statusInfo').innerText}`);
                    }
                }
            } catch (e) {}
        }

        function sendTele(m) { fetch(`https://api.telegram.org/bot${TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=${encodeURIComponent(m)}`); }
    </script>
</body>
</html>
