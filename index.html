<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTC BOT CONTROL PRO</title>
    <style>
        body { background: #0b0e11; color: white; font-family: sans-serif; text-align: center; padding: 15px; }
        .card { border: 2px solid #f3ba2f; border-radius: 12px; padding: 20px; background: #1e2329; }
        .price { font-size: 45px; font-weight: bold; color: #f3ba2f; }
        .log-box { text-align: left; background: #000; padding: 10px; height: 100px; overflow-y: auto; font-size: 12px; margin-top: 15px; border-radius: 5px; color: #2ebd85; }
        button { width: 100%; padding: 18px; background: #f3ba2f; color: black; font-weight: bold; border-radius: 10px; border: none; font-size: 20px; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="card">
        <div>BTC/USDT REALTIME</div>
        <div id="btcPrice" class="price">0.00</div>
        <div id="rsiVal" style="font-size: 20px;">RSI: --</div>
        <div id="status" style="margin-top: 10px; color: #848e9c;">ƒêANG ƒê·ª¢I K√çCH HO·∫†T...</div>
        <div id="logs" class="log-box">H·ªá th·ªëng s·∫µn s√†ng...</div>
        <button onclick="initBot()">K√çCH HO·∫†T H·ªÜ TH·ªêNG</button>
    </div>

    <script>
        const TOKEN = "8586899878:AAHONzWJqzUMswUPMjn5xaWvYrwDHSH4OYE";
        const CHAT_ID = "7994694689";
        let lastAction = "";
        let lastUpdateId = 0;

        function addLog(msg) {
            const div = document.getElementById('logs');
            div.innerHTML += `<br>> ${msg}`;
            div.scrollTop = div.scrollHeight;
        }

        async function initBot() {
            addLog("Bot ƒëang kh·ªüi ch·∫°y...");
            setInterval(updateMarket, 3000); // Qu√©t gi√°
            setInterval(checkTeleCommands, 2000); // Qu√©t l·ªánh Tele m·ªói 2s
            sendTele("ü§ñ BOT BTC ƒê√É S·∫¥N S√ÄNG!\nC√°c l·ªánh ƒëi·ªÅu khi·ªÉn:\n/tp : Reset bot sau khi ch·ªët l√£i\n/sl : Reset bot sau khi c·∫Øt l·ªó\n/dca : Nh·∫≠n plan DCA");
        }

        async function updateMarket() {
            try {
                const r = await fetch('https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=1m&limit=100');
                const d = await r.json();
                const prices = d.map(x => parseFloat(x[4]));
                const current = prices[prices.length - 1];

                // T√≠nh RSI
                let g = 0, l = 0;
                for (let i = prices.length - 14; i < prices.length; i++) {
                    let diff = prices[i] - prices[i-1];
                    if (diff >= 0) g += diff; else l -= diff;
                }
                const rsi = 100 - (100 / (1 + (g / l)));

                document.getElementById('btcPrice').innerText = current.toFixed(2);
                document.getElementById('rsiVal').innerText = "RSI: " + rsi.toFixed(2);

                // Logic v√†o l·ªánh (RSI 30/70)
                if (rsi <= 30 && lastAction !== "BUY") {
                    sendSignal("BUY", current, rsi);
                    lastAction = "BUY";
                } else if (rsi >= 70 && lastAction !== "SELL") {
                    sendSignal("SELL", current, rsi);
                    lastAction = "SELL";
                }
            } catch (e) {}
        }

        // Ch·ª©c nƒÉng ƒë·ªçc l·ªánh t·ª´ Telegram
        async function checkTeleCommands() {
            try {
                const r = await fetch(`https://api.telegram.org/bot${TOKEN}/getUpdates?offset=${lastUpdateId + 1}`);
                const d = await r.json();
                if (d.result && d.result.length > 0) {
                    for (let update of d.result) {
                        lastUpdateId = update.update_id;
                        const msg = update.message.text.toLowerCase();
                        
                        if (msg === "/tp" || msg === "/sl") {
                            lastAction = ""; // RESET ƒë·ªÉ bot c√≥ th·ªÉ b√°o l·ªánh m·ªõi ngay l·∫≠p t·ª©c
                            addLog(`ƒê√£ nh·∫≠n l·ªánh ${msg.toUpperCase()}. Bot ƒë√£ s·∫µn s√†ng k√®o ti·∫øp theo.`);
                            sendTele(`‚úÖ ƒê√£ x√°c nh·∫≠n ${msg.toUpperCase()}. Bot ƒëang qu√©t k√®o m·ªõi...`);
                        } 
                        else if (msg === "/dca") {
                            const p = document.getElementById('btcPrice').innerText;
                            const dcaPrice = lastAction === "BUY" ? (p - 150) : (parseFloat(p) + 150);
                            sendTele(`‚ö†Ô∏è [L·ªÜNH DCA]\nGi√° hi·ªán t·∫°i: ${p}\nƒêi·ªÉm DCA d·ª± ki·∫øn: ${dcaPrice.toFixed(2)}\nGi·ªØ nguy√™n SL c≈©.`);
                            addLog("ƒê√£ g·ª≠i Plan DCA theo y√™u c·∫ßu.");
                        }
                    }
                }
            } catch (e) {}
        }

        function sendSignal(side, price, rsi) {
            const sl = side === "SELL" ? price + 150 : price - 150;
            const tp = side === "SELL" ? price - 300 : price + 300;
            let m = `üîî [K√àO BTC ${side}]\nüìç Entry: ${price.toFixed(2)}\nüö´ SL: ${sl.toFixed(2)}\n‚úÖ TP: ${tp.toFixed(2)}\nüìä RSI: ${rsi.toFixed(2)}`;
            sendTele(m);
            addLog(`ƒê√£ b√°o k√®o ${side} t·∫°i ${price}`);
        }

        function sendTele(m) {
            fetch(`https://api.telegram.org/bot${TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=${encodeURIComponent(m)}`);
        }
    </script>
</body>
</html>
