<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GOLD TREND CHART 44xx</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <style>
        body { background: #0b0e11; color: white; font-family: sans-serif; text-align: center; margin: 0; padding: 10px; }
        .box { border: 2px solid #f0b90b; border-radius: 12px; padding: 15px; background: #1c1f24; margin-bottom: 10px; }
        #chart_div { width: 100%; height: 350px; background: #1c1f24; border-radius: 8px; }
        .price { font-size: 38px; font-weight: bold; color: #f0b90b; margin: 5px 0; }
        input { width: 90%; padding: 15px; margin: 10px 0; border-radius: 8px; border: 1px solid #444; background: #1e2329; color: white; text-align: center; font-size: 18px; }
        button { width: 90%; padding: 18px; background: #f0b90b; color: black; font-weight: bold; border-radius: 10px; border: none; font-size: 20px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="box">
        <div style="color: #848e9c; font-size: 14px;">BI·ªÇU ƒê·ªí V√ÄNG M1 - EXNESS 44xx</div>
        <div id="price" class="price">0.00</div>
        <div id="rsi" style="color: #2ebd85; font-weight: bold;">RSI: --</div>
        <div id="chart_div"></div>
    </div>

    <input type="number" id="exPrice" placeholder="Nh·∫≠p gi√° Exness (VD: 4413)">
    <button onclick="startBot()">B·∫¨T N·∫æN & QU√âT TREND</button>

    <script>
        google.charts.load('current', {'packages':['corechart']});
        const TOKEN = "8586899878:AAHONzWJqzUMswUPMjn5xaWvYrwDHSH4OYE";
        const CHAT_ID = "7994694689";
        let offset = 0, lastAction = "";

        async function startBot() {
            const val = parseFloat(document.getElementById('exPrice').value);
            if(!val) return alert("Nh·∫≠p gi√° 44xx ƒë√£ bro!");
            const r = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=PAXGUSDT');
            const d = await r.json();
            offset = val - parseFloat(d.price);
            
            setInterval(drawChart, 4000); // C·∫≠p nh·∫≠t n·∫øn m·ªói 4 gi√¢y
            sendTele("üî± N·∫æN ƒê√É L√äN - BOT ƒêANG QU√âT PLAN 10/20");
        }

        async function drawChart() {
            try {
                const r = await fetch('https://api.binance.com/api/v3/klines?symbol=PAXGUSDT&interval=1m&limit=30');
                const d = await r.json();
                
                // Chu·∫©n b·ªã d·ªØ li·ªáu n·∫øn
                let dataArray = d.map(x => [
                    "", // Th·ªùi gian
                    parseFloat(x[3]) + offset, // Th·∫•p
                    parseFloat(x[1]) + offset, // M·ªü
                    parseFloat(x[4]) + offset, // ƒê√≥ng
                    parseFloat(x[2]) + offset  // Cao
                ]);

                let data = google.visualization.arrayToDataTable(dataArray, true);
                let options = {
                    backgroundColor: '#1c1f24',
                    chartArea: {width: '90%', height: '80%'},
                    hAxis: {textStyle: {color: '#848e9c'}},
                    vAxis: {textStyle: {color: '#848e9c'}, gridlines: {color: '#2b2b2b'}},
                    candlestick: {
                        fallingColor: { strokeWidth: 0, fill: '#f6465d' },
                        risingColor: { strokeWidth: 0, fill: '#2ebd85' }
                    },
                    legend: 'none'
                };

                let chart = new google.visualization.CandlestickChart(document.getElementById('chart_div'));
                chart.draw(data, options);

                // C·∫≠p nh·∫≠t gi√° & RSI
                let lastClose = dataArray[dataArray.length-1][3];
                document.getElementById('price').innerText = lastClose.toFixed(2);
                
                let closes = d.map(x => parseFloat(x[4]));
                let rsi = calculateRSI(closes);
                document.getElementById('rsi').innerText = "RSI: " + rsi.toFixed(2);

                // Nh·∫≠n di·ªán Trend (Trung b√¨nh 30 n·∫øn)
                let sma = closes.reduce((a, b) => a + b, 0) / closes.length;
                let trend = lastClose > (sma + offset) ? "UP" : "DOWN";

                // Logic Plan 10/20
                if (trend === "DOWN" && rsi >= 65 && lastAction !== "SELL") {
                    sendSignal("SELL", lastClose, rsi, "DOWN TREND");
                    lastAction = "SELL";
                } else if (trend === "UP" && rsi <= 35 && lastAction !== "BUY") {
                    sendSignal("BUY", lastClose, rsi, "UP TREND");
                    lastAction = "BUY";
                } else if (rsi > 45 && rsi < 55) { lastAction = ""; }

            } catch (e) {}
        }

        function calculateRSI(p) {
            let g = 0, l = 0;
            for (let i = p.length - 14; i < p.length; i++) {
                let diff = p[i] - p[i-1];
                if (diff >= 0) g += diff; else l -= diff;
            }
            return 100 - (100 / (1 + (g / l)));
        }

        function sendSignal(side, price, rsi, trend) {
            const sl = side === "SELL" ? price + 10 : price - 10;
            const tp = side === "SELL" ? price - 20 : price + 20;
            let m = `üîî [PLAN ${side} THU·∫¨N TREND]\nüìç Entry: ${price.toFixed(2)}\nüö´ SL: ${sl.toFixed(2)}\n‚úÖ TP: ${tp.toFixed(2)}\nüî• Trend: ${trend}\nüìä RSI: ${rsi.toFixed(2)}`;
            fetch(`https://api.telegram.org/bot${TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=${encodeURIComponent(m)}`);
        }

        function sendTele(m) {
            fetch(`https://api.telegram.org/bot${TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=${encodeURIComponent(m)}`);
        }
    </script>
</body>
</html>
